---
title: "Agrobot Rover and Tool Changer"
permalink: /agrobot/
author_profile: false
sidebar:
  - title: "MIT Bioinstrumentation Lab"
    image: /assets/images/AgrobotIcon.png
    text: "Master's Student"
toc: true
toc_label: "Table of Contents"
toc_icon: "cog"
gallery:
  - url: /assets/images/AgrobotDSC00245.jpg
    image_path: /assets/images/AgrobotDSC00245.jpg
    alt: "placeholder image 1"
    title: "Agrobot 1"
  - url: /assets/images/AgrobotDSC00250.jpg
    image_path: /assets/images/AgrobotDSC00250.jpg
    alt: "placeholder image 1"
    title: "Agrobot 2"
  - url: /assets/images/AgrobotDSC00251.jpg
    image_path: /assets/images/AgrobotDSC00251.jpg
    alt: "placeholder image 1"
    title: "Agrobot 3"
  - url: /assets/images/AgrobotDSC00254.jpg
    image_path: /assets/images/AgrobotDSC00254.jpg
    alt: "placeholder image 1"
    title: "Agrobot back"
  - url: /assets/images/Agrobotbilabrover.jpg
    image_path: /assets/images/Agrobotbilabrover.jpg
    alt: "placeholder image 1"
    title: "Agrobot V2"
gallery2:
  - url: /assets/images/Agrobotbilabroverspecs.jpg
    image_path: /assets/images/Agrobotbilabroverspecs.jpg
    alt: "placeholder image 1"
    title: "Agrobot specs"
  - url: /assets/images/Agrobotbilabroverdesign.jpg
    image_path: /assets/images/Agrobotbilabroverdesign.jpg
    alt: "placeholder image 1"
    title: "Agrobot design"
  - url: /assets/images/Agrobotbilabroverinstruments.jpg
    image_path: /assets/images/Agrobotbilabroverinstruments.jpg
    alt: "placeholder image 1"
    title: "Agrobot infrastructure"
gallery3:
  - url: /assets/images/Agrobotrobotarm.png
    image_path: /assets/images/Agrobotrobotarm.png
    alt: "placeholder image 1"
    title: "Agrobot arm"
  - url: /assets/images/Agrobotrobotarmlabels.jpg
    image_path: /assets/images/Agrobotrobotarmlabels.jpg
    alt: "placeholder image 1"
    title: "Agrobot arm labels"
gallery4:
  - url: /assets/images/Agrobotrobotarmlink1inside.jpg
    image_path: /assets/images/Agrobotrobotarmlink1inside.jpg
    alt: "placeholder image 1"
    title: "Agrobot arm insides"
  - url: /assets/images/Agrobotrobotarmbeltclip.jpg
    image_path: /assets/images/Agrobotrobotarmbeltclip.jpg
    alt: "placeholder image 1"
    title: "Agrobot arm belt clip"
  - url: /assets/images/Agrobotrobotarmwrist.jpg
    image_path: /assets/images/Agrobotrobotarmwrist.jpg
    alt: "placeholder image 1"
    title: "Agrobot arm wrist"
  - url: /assets/images/Agrobotrobotarmfea.jpg
    image_path: /assets/images/Agrobotrobotarmfea.jpg
    alt: "placeholder image 1"
    title: "Agrobot arm FEA"
  - url: /assets/images/Agrobotrobotarmmanufacture.jpg
    image_path: /assets/images/Agrobotrobotarmmanufacture.jpg
    alt: "placeholder image 1"
    title: "Agrobot arm machined from stock"
  - url: /assets/images/Agrobotrobotarmelbowrouter.jpg
    image_path: /assets/images/Agrobotrobotarmelbowrouter.jpg
    alt: "placeholder image 1"
    title: "Agrobot arm redirecting wires"
gallery5:
  - url: /assets/images/Agrobottoolchanger.jpg
    image_path: /assets/images/Agrobottoolchanger.jpg
    alt: "placeholder image 1"
    title: "Tool changer assembled"
  - url: /assets/images/Agrobottoolchangerattached.jpg
    image_path: /assets/images/Agrobottoolchangerattached.jpg
    alt: "placeholder image 1"
    title: "Tool changer in use"
  - url: /assets/images/Agrobottoolchangerinterfaceview.jpg
    image_path: /assets/images/Agrobottoolchangerinterfaceview.jpg
    alt: "placeholder image 1"
    title: "Tool changer interface"
  - url: /assets/images/Agrobottoolchangersocket.jpg
    image_path: /assets/images/Agrobottoolchangersocket.jpg
    alt: "placeholder image 1"
    title: "Tool changer socket"
  - url: /assets/images/Agrobottoolchangersockethole.jpg
    image_path: /assets/images/Agrobottoolchangersockethole.jpg
    alt: "placeholder image 1"
    title: "Tool changer socket hole"
  - url: /assets/images/Agrobottoolchangerxsection.jpg
    image_path: /assets/images/Agrobottoolchangerxsection.jpg
    alt: "placeholder image 1"
    title: "Tool changer exchanging tool cross section"
gallery6:
  - url: /assets/images/Agrobotrobotarmcontrolboxwiring.jpg
    image_path: /assets/images/Agrobotrobotarmcontrolboxwiring.jpg
    alt: "placeholder image 1"
    title: "Agrobot arm wiring"
  - url: /assets/images/Agrobotrobotarmwiring.jpg
    image_path: /assets/images/Agrobotrobotarmwiring.jpg
    alt: "placeholder image 1"
    title: "Agrobot arm wiring 2"
  - url: /assets/images/Agrobotrobotarmmotor.jpg
    image_path: /assets/images/Agrobotrobotarmmotor.jpg
    alt: "placeholder image 1"
    title: "Mini cheetah motors"
  - url: /assets/images/Agrobotrobotarmcontrolbox.jpg
    image_path: /assets/images/Agrobotrobotarmcontrolbox.jpg
    alt: "placeholder image 1"
    title: "Control box"
  - url: /assets/images/Agrobotrobotarmstepdrive.jpg
    image_path: /assets/images/Agrobotrobotarmstepdrive.jpg
    alt: "placeholder image 1"
    title: "Stepper wrist driver PCB"
  - url: /assets/images/Agrobotrobotarmstepdriveass.jpg
    image_path: /assets/images/Agrobotrobotarmstepdriveass.jpg
    alt: "placeholder image 1"
    title: "Stepper driver mounted"
gallery7:
  - url: /assets/images/Agrobotrobotarmcontrolboxtoslink.jpg
    image_path: /assets/images/Agrobotrobotarmcontrolboxtoslink.jpg
    alt: "placeholder image 1"
    title: "TOSLink PCB"
  - url: /assets/images/Agrobotrobotarmcontrolboxtospcb.png
    image_path: /assets/images/Agrobotrobotarmcontrolboxtospcb.png
    alt: "placeholder image 1"
    title: "TOSLink PCB diagram"
gallery8:
  - url: /assets/images/Agrobotrobotarmautocon.jpg
    image_path: /assets/images/Agrobotrobotarmautocon.jpg
    alt: "placeholder image 1"
    title: "Agrobot arm automatic control"
  - url: /assets/images/Agrobotrobotarmmanualcontrol.jpg
    image_path: /assets/images/Agrobotrobotarmmanualcontrol.jpg
    alt: "placeholder image 1"
    title: "Agrobot arm manual control"
gallery9:
  - url: /assets/images/Agrobottoolchangercurrent.jpg
    image_path: /assets/images/Agrobottoolchangercurrent.jpg
    alt: "placeholder image 1"
    title: "Current spike when tool attached"
gallery10:
  - url: /assets/images/Agrobotthermalcamerareal.png
    image_path: /assets/images/Agrobotthermalcamerareal.png
    alt: "placeholder image 1"
    title: "Thermal camera"
  - url: /assets/images/Agrobotthermalcameracad.png
    image_path: /assets/images/Agrobotthermalcameracad.png
    alt: "placeholder image 1"
    title: "Thermal camera CAD"
  - url: /assets/images/Agrobotthermacameraudder.jpg
    image_path: /assets/images/Agrobotthermacameraudder.jpg
    alt: "placeholder image 1"
    title: "Fake udder thermal image"
  - url: /assets/images/Agrobotthermalcameratest.png
    image_path: /assets/images/Agrobotthermalcameratest.png
    alt: "placeholder image 1"
    title: "Testing thermal camera"
gallery11:
  - url: /assets/images/Agrobotimpedancereal.png
    image_path: /assets/images/Agrobotimpedancereal.png
    alt: "placeholder image 1"
    title: "Impedance probe"
  - url: /assets/images/Agrobotimpedancecad.png
    image_path: /assets/images/Agrobotimpedancecad.png
    alt: "placeholder image 1"
    title: "Impedance probe CAD"
  - url: /assets/images/Agrobotimpedancepcb.png
    image_path: /assets/images/Agrobotimpedancepcb.png
    alt: "placeholder image 1"
    title: "PCB design"
  - url: /assets/images/Agrobotimpedancecalcurve.png
    image_path: /assets/images/Agrobotimpedancecalcurve.png
    alt: "placeholder image 1"
    title: "Calibration curve"
  - url: /assets/images/Agrobotimpedanceerror.png
    image_path: /assets/images/Agrobotimpedanceerror.png
    alt: "placeholder image 1"
    title: "Impedance probe error"
  - url: /assets/images/Agrobotimpedancemodel.png
    image_path: /assets/images/Agrobotimpedancemodel.png
    alt: "placeholder image 1"
    title: "Probe model"
  - url: /assets/images/Agrobotimpedancerestest.png
    image_path: /assets/images/Agrobotimpedancerestest.png
    alt: "placeholder image 1"
    title: "Testing probe on resistors"
  - url: /assets/images/Agrobotimpedancesoiltest.png
    image_path: /assets/images/Agrobotimpedancesoiltest.png
    alt: "placeholder image 1"
    title: "Testing probe on soil"
gallery12:
  - url: /assets/images/Agrobotspectroscopyreal.png
    image_path: /assets/images/Agrobotspectroscopyreal.png
    alt: "placeholder image 1"
    title: "Spectroscopy sensor"
  - url: /assets/images/Agrobotspectroscopycad.png
    image_path: /assets/images/Agrobotspectroscopycad.png
    alt: "placeholder image 1"
    title: "Spectroscopy sensor CAD"
  - url: /assets/images/Agrobotspectroscopyleaves.png
    image_path: /assets/images/Agrobotspectroscopyleaves.png
    alt: "placeholder image 1"
    title: "Leaves used for testing"
  - url: /assets/images/Agrobotspectroscopyresponse.png
    image_path: /assets/images/Agrobotspectroscopyresponse.png
    alt: "placeholder image 1"
    title: "Spectroscopy response"
gallery13:
  - url: /assets/images/Agrobotirspectroscopyreal.PNG
    image_path: /assets/images/Agrobotirspectroscopyreal.PNG
    alt: "placeholder image 1"
    title: "NIR Spectroscopy sensor"
  - url: /assets/images/Agrobotirspectroscopycad.PNG
    image_path: /assets/images/Agrobotirspectroscopycad.PNG
    alt: "placeholder image 1"
    title: "NIR Spectroscopy sensor CAD"
  - url: /assets/images/Agrobotirspectroscopypsd.PNG
    image_path: /assets/images/Agrobotirspectroscopypsd.PNG
    alt: "placeholder image 1"
    title: "Power spectral density"
gallery14:
  - url: /assets/images/Agrobotphreal.png
    image_path: /assets/images/Agrobotphreal.png
    alt: "placeholder image 1"
    title: "pH probe"
  - url: /assets/images/Agrobotphcad.png
    image_path: /assets/images/Agrobotphcad.png
    alt: "placeholder image 1"
    title: "pH probe CAD"
  - url: /assets/images/Agrobotphtest.png
    image_path: /assets/images/Agrobotphtest.png
    alt: "placeholder image 1"
    title: "pH probe test"
---
The Agrobot Rover. My Master's Thesis.

I worked on this robot with another graduate student in the lab, Marc-Andre Begin. He was responsible for the main body of robot. I was responsible for the robotic arm, the miniature tool changer at the end, and a suite of prototype tools. I would later replace the treads of Rover V2 with heavy-duty all terrain wheels in Rover V3. 

There is so much material to discuss here. For the full thesis, follow this link [here](https://dspace.mit.edu/handle/1721.1/139075 "here").

# The Rover Overview

{% include gallery caption="Agrobot Version 3 and Version 2." %}

The main body of the Agrobot houses an Intel NUC, GPS, Intel Realsense camera, and massive electric brushed scooter motors. A powerful high current BasicMicro motor controller drives these motors. In the back of the rover is a docking bay that currently holds a battery but can also be used to house larger tools, such as methane cameras or other robots.

{% include gallery id="gallery2" caption="Agrobot specs and general build." %}

# The Arm

The arm has four degrees of freedom and boasts a miniature tool changer mounted on the wrist at the end. Most of the motors are mounted at the base of the arm in order to reduce the inertia at the joints. 

{% include gallery id="gallery3" caption="The Agrobot arm and tool changer." %}

## Design and Manufacturing

### Arm Design

The design of the arm was based on the leg of the Mini Cheetah robot that was built in the MIT Biomimetics Lab. With the motors mounted at the base, less torque is needed to accelerate the links of the arm. The third joint of the arm (rotating about the elbow) is actuated via a belt transmission that is housed in Link 2. For ease of manufacturing, assembly, and installation, the belt was cut and then spliced together, as the belt was expected to have a limited range of motion. At the wrist is a geared stepper motor that actuates the last degree of freedom, and the wrist itself has holes for bolting other attachments besides the tool changer if needed. This entire assembly is made of 7075 aluminum (machined by me on a very old Haas 3-axis CNC) and can withstand all the expected forces, even an unintentional one meter drop test. 

{% include gallery id="gallery4" caption="Agrobot arm insides and build." %}

### Miniature Modular Tool Exchanger

The miniature modular tool changer is mounted onto the wrist of the robotic arm and is designed to take in different types of tools. Inside the tool changer is a triangular lofted socket that matches the corresponding plug on the various tools I built for this project. The socket and plug were designed to be very similar to what I saw on a Mazak turning center that my lab had at the time. Once the plug enters the socket, there is a threaded stud that rotates until the plug is completely drawn in. 

{% include gallery id="gallery5" caption="The tool changer and how it works." %}

## Electronics

The first three joints on the Agrobot arm are driven by Mini Cheetah motors, which are high torque density brushless motors with a built in motor controller that is CANBus compatible. As mentioned before, the wrist is actuated by a stepper motor. I designed and built a custom PCB with a CANBus transceiver, stepper driver, Teensy, and step-down buck converter that can be placed on the CANBus daisy chain. The wires travel the length of the arm and connect to the arm control box. The box has a bunch of Tinkerforge bricks and bricklets acting as CANBus transceivers and safety switches. 

{% include gallery id="gallery6" caption="Agrobot arm electronics." %}

The control box contains several hardware parts for operating the tool changer. First, there is a Tinkerforge DC brick to drive the brushed motor on the tool changer. On the tool changer, there are two ports: one delivers power/ground and the other receives and sends data over a TOSLink optic cable. Hence, in the control box, there is a custom PCB I made that fits in the Tinkerforge infrastructure. It uses the TTL pins on the RS232 bricklet to send and receive data over a TOSLink transceiver. There is a Tinkerforge relay that turns on and off the power for the tool. The power and ground sockets/pins on the tool changer itself are low force insertion sockets and pins from Methode Electronics.

{% include gallery id="gallery7" caption="Tool changer communication electronics." %}

## Programming Infrastructure

I wrote a ROS package to control the arm and the tools. There are two ways to control the arm. One is an automated method, where you can run a pre-planned trajectory for the arm joints. To generate this trajectory, one option is to send a stream of joint commands. Another option is to physically move the arm to the desired positions and then save those joint positions, similar to Universal Robot collaborative arms can be programmed. The second method of controlling the arm is manually, where you can move the joints incrementally using keyboard commands. A Github repository for all of this can be found [here](https://github.com/ryanp543/agrobotarmcontrol "here").

{% include gallery id="gallery8" caption="Agrobot arm modes of control." %}

As for running the tool changer, the operation is quite simple. The current spikes when plug of the tool is drawn into socket, triggering the brushed motor coupled to the stud to stop immediately. By then, the power/ground pins and the TOSLink interface should have completely meshed, so communication with the attached tool can begin. 

{% include gallery id="gallery9" caption="Current spike when tool attached." %}

# Tools and Instruments

These are just some of the tools I built. Honestly, there are so many more tools that can be made for analyzing things not just in agriculture but also in general field work as well. I only built these five as a proof of concept for measuring potentially useful metrics on a farm. However, the potential for expanding this side of the project is limitless. Each tool came with a physical interface that is compatible with my tool changer as well as a custom-made TOSLink transceiver board that either communicated directly with the tool breakout board itself or an intermediary microcontroller. 

## Thermal Camera

The thermal camera is what it sounds like: a thermal camera. It uses an off-the-shelf Sparkfun breakout board with a FLIR Lepton camera and MicroPython capabilities. I programmed it to take both pictures and provide live video feed. On the farm, this tool can be used to detect some diseases in livestock that cause perceptible changes in surface temperature. 

{% include gallery id="gallery10" caption="The thermal camera tool." %}

## Impedance Analyzer

The impedance analyzer is used to measure soil moisture by doing a impedance measurements over a wide frequency sweep across two probes. These two stainless steel probes are connected to a Digilent pMod-IA breakout board that does the measurements. A Teensy LC and a custom-made intermediary board allows communication between the TOSlink transceiver and the pMod-IA board. The analyzer also comes with a spring loaded "wiper" to wipe off the dirt passively after every use. 

{% include gallery id="gallery11" caption="The impedance probe tool." %}

## Broad Spectrum Spectroscopy Sensor

This tool uses an affordable off-the-shelf spectroscopy sensor directly connected to my custom-made TOSLink transceiver board. It's quite simple: light of nine different wavelengths ranging from UV to infrared is delivered to a specimen, and the spectral response is collected. This can be used to determine plant health via differences in color. However, more elaborate calibration (i.e. a better way of quantifying "plant health" and its relationship to the spectral response) might be needed in the future.

{% include gallery id="gallery12" caption="The spectroscopy sensor tool." %}

## NIR Spectroscopy Sensor

Our lab got a request to use their high resolution NIR spectroscopy sensor for the same purposes (to measure plant health). This device is a lot more expense and has a much higher resolution of wavelengths, but the development package it comes mounted on is physically larger than the other spectroscopy sensor tool. The NIR spectroscopy sensor is mounted to a Raspberry PI Zero and can only be communicated with via Java. It would have been a hassle to integrate the TOSLink transceiver with the Raspberry Pi Zero. Instead, I connected to it via Wifi and had the data printed onto a serial terminal which I could copy and plot on the home Intel NUC computer. It wasn't the best workaround, but I'll admit...working with someone else's Java code is not my forte.

{% include gallery id="gallery13" caption="The NIR spectroscopy sensor tool." %}

## pH Probe

Probably the simplest tool. A pH probe for measuring pH. I got the probe from Atlas Scientific, along with the breakout board that I could connect directly to my TOSLink transceiver. I made a clamping mount for the probe. The wire it came with was quite long, so I cut it and spliced it carefully after cleaning it (because I've had problems in the past with data transferred over solder joints).

{% include gallery id="gallery14" caption="The pH probe tool." %}

# Streamlined PID Tuning Procedure

Marc and I wrote a paper about a streamlined PID tuning procedure for flexible base manipulators like the robotic arm mounted on our rover with suspension. The paper got accepted into IROS. Essentially, we came up with a Lyapunov candidate function that allowed us to figure out what PID gains to choose and for which states our system was stable. If you're interested, check out the paper below!

Paper is here:

[Download PDF]({{ site.baseurl }}/assets/pdf/Streamlined_Tuning_Procedure_for_Stable_PID_Control_of_Flexible-Base_Manipulators.pdf)